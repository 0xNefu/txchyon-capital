---
import Layout from '../layouts/Base.astro';

// Sample Data - FIXED: Missing object wrapper for 4th KPI
const kpis = [
  { title: 'Total Assets Value', value: '$2.8M', change: '+2.4%', icon: 'üí∞' },
  { title: 'Monthly Cashflow', value: '$85,450', change: '+5.1%', icon: 'üìä' },
  { title: 'Total ROI %', value: '142%', change: '+1.2%', icon: 'üìà' },
  { title: 'Active Businesses', value: '5', change: '+1', icon: 'üè¢' }, // FIXED: Added { }
  { title: 'Total Leads (monthly)', value: '1,240', change: '+12%', icon: 'üë•' },
];

// NEW: Stats tabs data
const statsTabsData = {
  overview: [
    { label: 'Monthly Growth', value: '8.2%', change: '+0.5%', icon: 'üìà' },
    { label: 'Net Profit Margin', value: '32%', change: '+3.1%', icon: 'üíπ' },
    { label: 'Traffic Growth', value: '18.5K', change: '+24%', icon: 'üöÄ' },
    { label: 'Avg. Deal Size', value: '$2,450', change: '+$120', icon: 'üí∞' },
  ],
  performance: [
    { label: 'Best Performer', value: 'DeFi Blog', metric: '+42% ROI', icon: 'ü•á' },
    { label: 'Conversion Rate', value: '4.8%', change: '+0.7%', icon: 'üéØ' },
    { label: 'CAC', value: '$125', change: '-$18', icon: 'üìâ' },
    { label: 'LTV', value: '$2,850', change: '+$320', icon: 'üìä' },
  ],
  projects: [
    { label: 'Active Projects', value: '7', icon: '‚ö°' },
    { label: 'Behind Schedule', value: '2', icon: '‚ö†Ô∏è' },
    { label: 'Completed This Month', value: '4', icon: '‚úÖ' },
    { label: 'Pending Approval', value: '3', icon: '‚è≥' },
  ],
};

const assets = [
  { name: 'Txchyon (DeFi Megablog)', type: 'Blog', status: 'Scaling', revenue: '$45,200', notes: 'Content refresh in Q1' },
  { name: 'Insurance Megablog', type: 'Blog', status: 'Active', revenue: '$28,500', notes: 'Lead gen performing well' },
  { name: 'Roofing Megablog', type: 'Blog', status: 'Active', revenue: '$18,750', notes: 'Seasonal spike expected' },
  { name: 'Home Services Megablog', type: 'Blog', status: 'Active', revenue: '$32,500', notes: 'New funnel testing' },
  { name: 'Music IP', type: 'IP', status: 'Active', revenue: '$4,500', notes: 'Royalties stable' },
];

const investments = [
  { asset: 'BTC', allocation: '35%', costBasis: '$28,500', currentValue: '$42,500', roi: '+49.12%' },
  { asset: 'S&P 500 ETF', allocation: '25%', costBasis: '$420,000', currentValue: '$515,000', roi: '+22.62%' },
  { asset: 'Ethereum', allocation: '15%', costBasis: '$1,800', currentValue: '$2,200', roi: '+22.22%' },
  { asset: 'Private Equity', allocation: '15%', costBasis: '$150,000', currentValue: '$210,000', roi: '+40.00%' },
  { asset: 'Cash Reserve', allocation: '10%', costBasis: '$100,000', currentValue: '$100,000', roi: '0.00%' },
];

const tasks = {
  todo: [
    { title: 'Review Q1 marketing budget', assigned: 'Founder', priority: 'High' },
    { title: 'Write 5 DeFi articles', assigned: 'Writer', priority: 'Medium' },
  ],
  inProgress: [
    { title: 'Dashboard development', assigned: 'Dev', priority: 'High' },
  ],
  completed: [
    { title: 'Monthly financial review', assigned: 'Founder', priority: 'Medium' },
  ],
};
---

<Layout>
  <!-- Header with Logo, Navigation & Dark Mode -->
  <div class="flex items-center justify-between mb-8">
    <!-- Left: Logo, Title & Navigation -->
    <div class="flex items-center gap-6">
      <!-- Logo -->
      <div class="flex-shrink-0">
        <img 
          src="/images/logo.png" 
          alt="Txchyon Capital Logo" 
          class="h-12 w-auto object-contain filter brightness-110 contrast-110 dark:brightness-125 dark:contrast-125"
          onerror="this.style.display='none'; document.getElementById('dashboard-fallback-logo').style.display='block';"
        />
        <div id="dashboard-fallback-logo" class="hidden">
          <div class="text-4xl">üåå</div>
        </div>
      </div>
      
      <!-- Title and Navigation -->
      <div class="flex flex-col">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Dashboard Overview</h1>
        <p class="text-gray-600 dark:text-gray-300 mb-2">Internal capital management dashboard</p>
        
        <!-- NEW: Navigation Tabs -->
        <div class="flex items-center gap-4 mt-2">
          <button id="nav-home" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition duration-200 flex items-center gap-2 text-sm">
            <span>üè†</span>
            Home
          </button>
          <button id="nav-assets" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium rounded-lg transition duration-200 flex items-center gap-2 text-sm">
            <span>üìÅ</span>
            Assets
          </button>
          <button id="nav-analytics" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium rounded-lg transition duration-200 flex items-center gap-2 text-sm">
            <span>üìä</span>
            Analytics
          </button>
          <button id="nav-settings" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium rounded-lg transition duration-200 flex items-center gap-2 text-sm">
            <span>‚öôÔ∏è</span>
            Settings
          </button>
        </div>
      </div>
    </div>
    
    <!-- Right: Actions, Date/Time & Logout -->
    <div class="flex items-center gap-4">
      <!-- Date/Time Display -->
      <div class="hidden md:block text-sm text-gray-500 dark:text-gray-400">
        <div id="current-date" class="font-medium"></div>
        <div id="current-time" class="text-xs"></div>
      </div>
      
      <!-- NEW: Quick Actions Dropdown -->
      <div class="relative">
        <button id="quick-actions-btn" 
                class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                aria-label="Quick Actions"
                title="Quick Actions">
          <span class="text-lg">‚ö°</span>
        </button>
        <div id="quick-actions-menu" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-10">
          <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
            <span class="mr-2">üìà</span> Add New Metric
          </a>
          <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
            <span class="mr-2">üìù</span> Create Report
          </a>
          <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
            <span class="mr-2">üéØ</span> Set Target
          </a>
          <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
          <a href="/" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
            <span class="mr-2">‚Ü©Ô∏è</span> Return to System
          </a>
        </div>
      </div>
      
      <!-- Dark Mode Toggle -->
      <button id="theme-toggle" 
              class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
              aria-label="Toggle dark mode"
              title="Toggle dark/light mode">
        <span id="theme-icon-sun" class="hidden text-lg">‚òÄÔ∏è</span>
        <span id="theme-icon-moon" class="text-lg">üåô</span>
      </button>
      
      <!-- Logout Button -->
      <button onclick="logout()" 
              class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition duration-200 flex items-center gap-2"
              title="Logout of dashboard">
        <span>üö™</span>
        <span class="hidden sm:inline">Logout</span>
      </button>
    </div>
  </div>

  <!-- NEW: Stats Tabs Section -->
  <div class="mb-8 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Performance Metrics</h2>
      <div class="flex gap-2">
        <button id="stats-tab-overview" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition duration-200 text-sm">
          Overview
        </button>
        <button id="stats-tab-performance" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium rounded-lg transition duration-200 text-sm">
          Performance
        </button>
        <button id="stats-tab-projects" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium rounded-lg transition duration-200 text-sm">
          Projects
        </button>
      </div>
    </div>
    
    <!-- Stats Content (Dynamic) -->
    <div id="stats-content">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
        {statsTabsData.overview.map(stat => (
          <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border border-gray-200 dark:border-gray-600">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xl">{stat.icon}</span>
              <span class="text-sm font-medium text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30 px-2 py-1 rounded">
                {stat.change}
              </span>
            </div>
            <div class="text-sm text-gray-500 dark:text-gray-400">{stat.label}</div>
            <div class="text-xl font-bold text-gray-900 dark:text-white mt-1">{stat.value}</div>
          </div>
        ))}
      </div>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
    {kpis.map(kpi => (
      <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow duration-200 group">
        <div class="flex items-center justify-between mb-4">
          <span class="text-2xl group-hover:scale-110 transition-transform duration-200">{kpi.icon}</span>
          <span class="text-sm font-medium text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30 px-2 py-1 rounded">
            {kpi.change}
          </span>
        </div>
        <div class="text-sm text-gray-500 dark:text-gray-400">{kpi.title}</div>
        <div class="text-2xl font-bold text-gray-900 dark:text-white mt-1">{kpi.value}</div>
      </div>
    ))}
  </div>

  <!-- Main Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Assets Section -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Asset Portfolio</h2>
        <a href="/assets" class="text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1">
          View all
          <span>‚Üí</span>
        </a>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b border-gray-200 dark:border-gray-700">
              <th class="text-left py-3 text-sm font-medium text-gray-500 dark:text-gray-400">Name</th>
              <th class="text-left py-3 text-sm font-medium text-gray-500 dark:text-gray-400">Type</th>
              <th class="text-left py-3 text-sm font-medium text-gray-500 dark:text-gray-400">Status</th>
              <th class="text-left py-3 text-sm font-medium text-gray-500 dark:text-gray-400">Revenue</th>
            </tr>
          </thead>
          <tbody>
            {assets.map(asset => (
              <tr class="border-b border-gray-100 dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors">
                <td class="py-3 text-sm font-medium text-gray-900 dark:text-white">{asset.name}</td>
                <td class="py-3 text-sm text-gray-500 dark:text-gray-400">{asset.type}</td>
                <td class="py-3">
                  <span class={`px-2 py-1 text-xs font-medium rounded-full ${asset.status === 'Scaling' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400' : 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400'}`}>
                    {asset.status}
                  </span>
                </td>
                <td class="py-3 text-sm font-medium text-gray-900 dark:text-white">{asset.revenue}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Investments Section -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Investments</h2>
        <a href="/investments" class="text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1">
          View all
          <span>‚Üí</span>
        </a>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b border-gray-200 dark:border-gray-700">
              <th class="text-left py-3 text-sm font-medium text-gray-500 dark:text-gray-400">Asset</th>
              <th class="text-left py-3 text-sm font-medium text-gray-500 dark:text-gray-400">Allocation</th>
              <th class="text-left py-3 text-sm font-medium text-gray-500 dark:text-gray-400">Cost Basis</th>
              <th class="text-left py-3 text-sm font-medium text-gray-500 dark:text-gray-400">Current Value</th>
              <th class="text-left py-3 text-sm font-medium text-gray-500 dark:text-gray-400">ROI</th>
            </tr>
          </thead>
          <tbody>
            {investments.map(inv => (
              <tr class="border-b border-gray-100 dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors">
                <td class="py-3 text-sm font-medium text-gray-900 dark:text-white">{inv.asset}</td>
                <td class="py-3 text-sm text-gray-500 dark:text-gray-400">{inv.allocation}</td>
                <td class="py-3 text-sm text-gray-500 dark:text-gray-400">{inv.costBasis}</td>
                <td class="py-3 text-sm font-medium text-gray-900 dark:text-white">{inv.currentValue}</td>
                <td class={`py-3 text-sm font-medium ${parseFloat(inv.roi) > 0 ? 'text-green-600 dark:text-green-400' : 'text-gray-500 dark:text-gray-400'}`}>
                  {inv.roi}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Workflow Section -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Workflow / Tasks</h2>
        <a href="/workflow" class="text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1">
          View all
          <span>‚Üí</span>
        </a>
      </div>
      <div class="grid grid-cols-3 gap-4">
        <div>
          <div class="text-center bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-300 py-2 rounded-t-lg font-medium">To Do</div>
          <div class="space-y-3 mt-3">
            {tasks.todo.map(task => (
              <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded border border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500 transition-colors">
                <div class="font-medium text-sm text-gray-900 dark:text-white">{task.title}</div>
                <div class="flex justify-between items-center mt-2">
                  <span class="text-xs text-gray-500 dark:text-gray-400">{task.assigned}</span>
                  <span class={`text-xs px-2 py-1 rounded ${task.priority === 'High' ? 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300' : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300'}`}>
                    {task.priority}
                  </span>
                </div>
              </div>
            ))}
          </div>
        </div>
        <div>
          <div class="text-center bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300 py-2 rounded-t-lg font-medium">In Progress</div>
          <div class="space-y-3 mt-3">
            {tasks.inProgress.map(task => (
              <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded border border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500 transition-colors">
                <div class="font-medium text-sm text-gray-900 dark:text-white">{task.title}</div>
                <div class="flex justify-between items-center mt-2">
                  <span class="text-xs text-gray-500 dark:text-gray-400">{task.assigned}</span>
                  <span class="text-xs px-2 py-1 rounded bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300">
                    {task.priority}
                  </span>
                </div>
              </div>
            ))}
          </div>
        </div>
        <div>
          <div class="text-center bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-300 py-2 rounded-t-lg font-medium">Completed</div>
          <div class="space-y-3 mt-3">
            {tasks.completed.map(task => (
              <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded border border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500 transition-colors">
                <div class="font-medium text-sm text-gray-900 dark:text-white">{task.title}</div>
                <div class="flex justify-between items-center mt-2">
                  <span class="text-xs text-gray-500 dark:text-gray-400">{task.assigned}</span>
                  <span class="text-xs px-2 py-1 rounded bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300">
                    {task.priority}
                  </span>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>

    <!-- Notes Section -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Notes / Alerts</h2>
        <button onclick="document.getElementById('notes-textarea').focus()" class="text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1">
          Edit
          <span>‚úèÔ∏è</span>
        </button>
      </div>
      <textarea 
        id="notes-textarea"
        class="w-full h-48 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg p-4 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
        placeholder="Strategy notes, reminders, market alerts, weekly focus..."
      ># Weekly Focus

## Strategic Goals
- Scale DeFi content vertical
- Evaluate new acquisition targets
- Optimize existing funnels

## Key Metrics to Watch
- Organic traffic growth
- Lead conversion rate
- CAC/LTV ratio

## Market Alerts
BTC testing resistance at $45K
Fed meeting next week</textarea>
      <div class="flex justify-between items-center mt-4">
        <button id="clear-notes" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium rounded-lg transition duration-200 flex items-center gap-2 text-sm">
          <span>üóëÔ∏è</span>
          Clear
        </button>
        <button id="save-notes" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition duration-200 flex items-center gap-2">
          <span>üíæ</span>
          Save Notes
        </button>
      </div>
    </div>
  </div>
</Layout>

<style>
  /* Add smooth transitions */
  * {
    transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
  }
  
  /* Better table styling */
  table {
    border-collapse: separate;
    border-spacing: 0;
  }
  
  th, td {
    padding: 12px 16px;
  }
  
  /* Scrollbar styling */
  .overflow-x-auto::-webkit-scrollbar {
    height: 6px;
  }
  
  .overflow-x-auto::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
  }
  
  .overflow-x-auto::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
  }
  
  .dark .overflow-x-auto::-webkit-scrollbar-track {
    background: #374151;
  }
  
  .dark .overflow-x-auto::-webkit-scrollbar-thumb {
    background: #6b7280;
  }
  
  /* Logo styling */
  .logo-hover:hover {
    filter: brightness(1.15) contrast(1.15);
  }
  
  /* Quick actions menu animation */
  #quick-actions-menu {
    animation: fadeIn 0.2s ease-out;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  // Stats tabs data for frontend
  const statsTabs = {
    overview: [
      { label: 'Monthly Growth', value: '8.2%', change: '+0.5%', icon: 'üìà' },
      { label: 'Net Profit Margin', value: '32%', change: '+3.1%', icon: 'üíπ' },
      { label: 'Traffic Growth', value: '18.5K', change: '+24%', icon: 'üöÄ' },
      { label: 'Avg. Deal Size', value: '$2,450', change: '+$120', icon: 'üí∞' },
    ],
    performance: [
      { label: 'Best Performer', value: 'DeFi Blog', metric: '+42% ROI', icon: 'ü•á' },
      { label: 'Conversion Rate', value: '4.8%', change: '+0.7%', icon: 'üéØ' },
      { label: 'CAC', value: '$125', change: '-$18', icon: 'üìâ' },
      { label: 'LTV', value: '$2,850', change: '+$320', icon: 'üìä' },
    ],
    projects: [
      { label: 'Active Projects', value: '7', icon: '‚ö°' },
      { label: 'Behind Schedule', value: '2', icon: '‚ö†Ô∏è' },
      { label: 'Completed This Month', value: '4', icon: '‚úÖ' },
      { label: 'Pending Approval', value: '3', icon: '‚è≥' },
    ]
  };

  // Dark Mode Toggle
  function toggleDarkMode() {
    const html = document.documentElement;
    const isDark = html.classList.contains('dark');
    const newTheme = isDark ? 'light' : 'dark';
    
    if (newTheme === 'dark') {
      html.classList.add('dark');
      html.setAttribute('data-theme', 'dark');
    } else {
      html.classList.remove('dark');
      html.setAttribute('data-theme', 'light');
    }
    
    localStorage.setItem('theme', newTheme);
    updateThemeIcons();
  }
  
  function updateThemeIcons() {
    const sunIcon = document.getElementById('theme-icon-sun');
    const moonIcon = document.getElementById('theme-icon-moon');
    const isDark = document.documentElement.classList.contains('dark');
    
    if (sunIcon) sunIcon.classList.toggle('hidden', isDark);
    if (moonIcon) moonIcon.classList.toggle('hidden', !isDark);
  }
  
  // Logout Function
  function logout() {
    localStorage.removeItem('txchyon_capital_auth');
    localStorage.removeItem('txchyon_last_login');
    window.location.href = '/';
  }
  
  // Update Date and Time
  function updateDateTime() {
    const now = new Date();
    
    // Format date
    const dateOptions = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
    const dateElement = document.getElementById('current-date');
    if (dateElement) {
      dateElement.textContent = now.toLocaleDateString('en-US', dateOptions);
    }
    
    // Format time
    const timeElement = document.getElementById('current-time');
    if (timeElement) {
      timeElement.textContent = now.toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit',
        hour12: true 
      });
    }
  }
  
  // Stats Tabs Functionality
  function setupStatsTabs() {
    const tabs = ['overview', 'performance', 'projects'];
    const statsContent = document.getElementById('stats-content');
    
    tabs.forEach(tabName => {
      const tabBtn = document.getElementById(`stats-tab-${tabName}`);
      if (tabBtn) {
        tabBtn.addEventListener('click', () => {
          // Update active tab styling
          tabs.forEach(t => {
            const btn = document.getElementById(`stats-tab-${t}`);
            if (btn) {
              if (t === tabName) {
                btn.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                btn.classList.add('bg-blue-600', 'hover:bg-blue-700', 'text-white');
              } else {
                btn.classList.remove('bg-blue-600', 'hover:bg-blue-700', 'text-white');
                btn.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
              }
            }
          });
          
          // Update content
          if (statsContent && statsTabs[tabName]) {
            const statsData = statsTabs[tabName];
            statsContent.innerHTML = `
              <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                ${statsData.map(stat => `
                  <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border border-gray-200 dark:border-gray-600">
                    <div class="flex items-center justify-between mb-2">
                      <span class="text-xl">${stat.icon}</span>
                      ${stat.change ? `
                        <span class="text-sm font-medium text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30 px-2 py-1 rounded">
                          ${stat.change}
                        </span>
                      ` : ''}
                    </div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">${stat.label}</div>
                    <div class="text-xl font-bold text-gray-900 dark:text-white mt-1">${stat.value}</div>
                    ${stat.metric ? `<div class="text-xs text-gray-500 dark:text-gray-400 mt-1">${stat.metric}</div>` : ''}
                  </div>
                `).join('')}
              </div>
            `;
          }
          
          // Save active tab
          localStorage.setItem('active_stats_tab', tabName);
        });
      }
    });
  }
  
  // Quick Actions Menu
  function setupQuickActions() {
    const btn = document.getElementById('quick-actions-btn');
    const menu = document.getElementById('quick-actions-menu');
    
    if (btn && menu) {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        menu.classList.toggle('hidden');
      });
      
      // Close menu when clicking outside
      document.addEventListener('click', (e) => {
        if (!menu.contains(e.target) && !btn.contains(e.target)) {
          menu.classList.add('hidden');
        }
      });
    }
  }
  
  // Notes Functionality
  function setupNotes() {
    const notesTextarea = document.getElementById('notes-textarea');
    const saveBtn = document.getElementById('save-notes');
    const clearBtn = document.getElementById('clear-notes');
    let saveTimeout;
    
    if (notesTextarea) {
      // Auto-save after 5 seconds of inactivity
      notesTextarea.addEventListener('input', () => {
        clearTimeout(saveTimeout);
        saveTimeout = setTimeout(() => {
          saveNotes();
        }, 5000);
      });
      
      // Load saved notes
      const savedNotes = localStorage.getItem('dashboard_notes');
      if (savedNotes) {
        notesTextarea.value = savedNotes;
      }
    }
    
    if (saveBtn) {
      saveBtn.addEventListener('click', saveNotes);
    }
    
    if (clearBtn) {
      clearBtn.addEventListener('click', () => {
        if (confirm('Clear all notes?')) {
          notesTextarea.value = '';
          localStorage.removeItem('dashboard_notes');
        }
      });
    }
    
    function saveNotes() {
      if (!notesTextarea) return;
      
      const notes = notesTextarea.value;
      localStorage.setItem('dashboard_notes', notes);
      
      // Visual feedback
      const originalText = saveBtn.innerHTML;
      saveBtn.innerHTML = '<span>‚úÖ</span> Saved!';
      saveBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
      saveBtn.classList.add('bg-green-600', 'hover:bg-green-700');
      
      setTimeout(() => {
        saveBtn.innerHTML = originalText;
        saveBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
        saveBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
      }, 1500);
    }
  }
  
  // Navigation Setup
  function setupNavigation() {
    // Home button (already active)
    document.getElementById('nav-assets')?.addEventListener('click', () => {
      window.location.href = '/assets';
    });
    
    document.getElementById('nav-analytics')?.addEventListener('click', () => {
      window.location.href = '/analytics';
    });
    
    document.getElementById('nav-settings')?.addEventListener('click', () => {
      window.location.href = '/settings';
    });
  }
  
  // Initialize on page load
  document.addEventListener('DOMContentLoaded', () => {
    // Dark mode toggle
    const toggleBtn = document.getElementById('theme-toggle');
    if (toggleBtn) {
      toggleBtn.addEventListener('click', toggleDarkMode);
    }
    updateThemeIcons();
    
    // Date/time
    updateDateTime();
    setInterval(updateDateTime, 60000);
    
    // Setup all functionality
    setupStatsTabs();
    setupQuickActions();
    setupNotes();
    setupNavigation();
    
    // Restore active stats tab
    const activeTab = localStorage.getItem('active_stats_tab') || 'overview';
    const activeTabBtn = document.getElementById(`stats-tab-${activeTab}`);
    if (activeTabBtn) activeTabBtn.click();
    
    // Logo hover effect
    const logo = document.querySelector('img[alt="Txchyon Capital Logo"]');
    if (logo) {
      logo.addEventListener('mouseenter', () => {
        logo.classList.add('logo-hover');
      });
      logo.addEventListener('mouseleave', () => {
        logo.classList.remove('logo-hover');
      });
    }
  });
</script>