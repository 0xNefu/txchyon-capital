---
import Social from "@/components/social.astro";
import config from "@/config/config.json";
import menu from "@/config/menu.json";
import social from "@/config/social.json";
import { markdownify } from "@/lib/utils/textConverter";
import { getCollection } from 'astro:content';

// Get all posts to count
const allPosts = await getCollection('posts');
const publishedPosts = allPosts.filter(post => !post.data.draft);
const totalPosts = allPosts.length;
const draftCount = totalPosts - publishedPosts.length;

// Get the current page URL to check what type of page we're on
const url = Astro.url.pathname;
const isHomePage = url === '/' || url === '/index.html';
---

<footer class="section bg-dark">
  <div class="container text-center">
    {/* Footer menu - Updated: removed Blog, added Services */}
    <ul class="mb-8 space-x-4">
      {
        menu.footer.map((item) => (
          // Only show items that aren't "Blog"
          item.name.toLowerCase() !== "blog" && (
            <li class="inline-block">
              <a
                href={item.url}
                class="p-4 text-white/75 hover:text-white transition-all"
              >
                {item.name}
              </a>
            </li>
          )
        ))
      }
      <li class="inline-block">
        <a
          href="/tools"
          class="p-4 text-white/75 hover:text-white transition-all"
        >
          Toolkit
        </a>
      </li>
      {/* Add Services link to TheReplyGuy */}
      <li class="inline-block">
        <a
          href="https://replyguy.carrd.co"
          target="_blank"
          class="p-4 text-white/75 hover:text-white transition-all"
        >
          Services
        </a>
      </li>
      {/* Add Contact Us to footer */}
      <li class="inline-block">
        <a
          href="/contact"
          class="p-4 text-white/75 hover:text-white transition-all"
        >
          Contact Us
        </a>
      </li>
    </ul>

    {/* Social icons */}
    <Social class="social-icons mb-8" />

    {/* Newsletter on home, nothing else on other pages */}
    {
      isHomePage ? (
        <div class="mb-8">
          <script async src="https://subscribe-forms.beehiiv.com/embed.js"></script>
          <iframe 
            src="https://subscribe-forms.beehiiv.com/62d85daa-7878-4a83-a78a-a15f6226c516" 
            class="beehiiv-embed"
            frameborder="0" 
            scrolling="no"
            style="
              width: 100%;
              max-width: 400px;
              height: 150px;
              margin: 0 auto;
              border-radius: 0;
              background-color: transparent;
              border: none;
            "
          ></iframe>
        </div>
      ) : (
        /* Empty div to maintain spacing - Telegram removed */
        <div class="mb-8"></div>
      )
    }

    {/* Guide Counts - UPDATED */}
    <div class="mb-6 space-y-3">
      {/* Published Guides */}
      <p class="text-white/75 text-lg">
        <span class="inline-flex items-center gap-2">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.968 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/>
          </svg>
          <span class="font-semibold text-green-400">{publishedPosts.length}</span> 
          <span>Guides Published</span>
        </span>
      </p>

      {/* Total Guides */}
      <p class="text-white/60 text-base">
        <span class="inline-flex items-center gap-2">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
          </svg>
          <span class="font-semibold text-blue-400">{totalPosts}</span> 
          <span>Total Guides</span>
          {draftCount > 0 && (
            <span class="text-xs text-yellow-400 ml-2">
              ({draftCount} in draft)
            </span>
          )}
        </span>
      </p>
    </div>

    {/* Copyright */}
    <p class="text-white/75">Â© 2025 Txchyon Capital</p>
  </div>
</footer>